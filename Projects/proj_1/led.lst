C51 COMPILER V9.01   LED                                                                   05/15/2023 14:41:55 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN .\led.obj
COMPILER INVOKED BY: D:\C51\BIN\C51.EXE ..\..\App\led.c BROWSE INCDIR(..\..\Public;..\..\App) DEBUG OBJECTEXTEND PRINT(.
                    -\led.lst) OBJECT(.\led.obj)

line level    source

   1          //==头文件==
   2          #include <STC12C5A.h> // 51标准头文件
   3          #include "led.h"
   4          #include "key.h"
   5          #include "adda.h"
   6          //==========
   7          sbit D_SER = P1 ^ 0;
   8          sbit D_SRCLK = P1 ^ 1;
   9          sbit D_RCLK = P1 ^ 2;
  10          //==变量==
  11          unsigned char 
  12          dspbuf[4] = {    // 数码管显示缓存
  13              0x11, 0x11, 0x11, 0x11
  14          }, 
  15          dspchar[10] = {  // 数码管字符表0-9
  16                  0x11,0x7d,0x23,0x29,
  17                  0x4d,0x89,0x81,0x3d,
  18                  0x01,0x09       
  19          },
  20                  sel = 0;
  21          //========
  22          void dsptask()
  23          {
  24   1          unsigned char i;    // for loop 临时变量
  25   1          unsigned char a, b; // a:数码管位选，b:掩码
  26   1      
  27   1          // 数码管位选
  28   1          switch (sel)
  29   1          {
  30   2          case 0:        // L1-T204
  31   2              a = 0x01;
  32   2              break; 
  33   2          case 1:        // L2-T203
  34   2              a = 0x02;  
  35   2              break; 
  36   2          case 2:        // L3-T202
  37   2              a = 0x04;
  38   2              break;          
  39   2          default:   // L4-T201
  40   2              a = 0x08; 
  41   2          }
  42   1              // 将表示数码管位选的信息输入到74HC565的高位8bit 
  43   1              // 对应数码管的COM1为高电平（共阳极数码管）
  44   1          for (b = 0x80, i = 0; i < 8; i++)
  45   1          {
  46   2              if (a & b)
  47   2                  D_SER = 1;
  48   2              else
  49   2                  D_SER = 0;
  50   2              D_SRCLK = 0;
  51   2              D_SRCLK = 1;
  52   2              D_SRCLK = 0;
  53   2              b = b >> 1;
  54   2              // b=b&0x7f;
C51 COMPILER V9.01   LED                                                                   05/15/2023 14:41:55 PAGE 2   

  55   2          }
  56   1          // 载入位选数码管对应的显示内容
  57   1          a = dspbuf[sel];
  58   1              // 按键列选择
  59   1              key_col = sel;
  60   1              // 索引改变，选择下一个数码管
  61   1          sel++;
  62   1          if (sel >= 4)
  63   1              sel = 0; 
  64   1              // 将数码管对应显示内容输入到级联74HC565的低8bit
  65   1          for (b = 0x80, i = 0; i < 8; i++)
  66   1          {
  67   2              if (a & b)
  68   2                  D_SER = 1;
  69   2              else
  70   2                  D_SER = 0;
  71   2              D_SRCLK = 0;
  72   2              D_SRCLK = 1;
  73   2              D_SRCLK = 0;
  74   2              b = b >> 1;
  75   2              // b=b&0x7fff;
  76   2          }
  77   1          D_RCLK = 0;
  78   1          D_RCLK = 1;
  79   1          D_RCLK = 0;
  80   1      }
  81          void fdisp(unsigned char num,unsigned char id)
  82          {
  83   1              char c;
  84   1              switch(num){
  85   2                      case 0: c = 0x11; break;
  86   2                      case 1: c = 0x7d; break;
  87   2                      case 2: c = 0x23; break;
  88   2                      case 3: c = 0x29; break;
  89   2                      case 4: c = 0x4d; break;
  90   2                      case 5: c = 0x89; break;
  91   2                      case 6: c = 0x81; break;
  92   2                      case 7: c = 0x3d; break;
  93   2                      case 8: c = 0x01; break;
  94   2                      case 9: c = 0x09; break;
  95   2                      default:c = 0xff; break;
  96   2              }
  97   1              dspbuf[id] = c;
  98   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    203    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
